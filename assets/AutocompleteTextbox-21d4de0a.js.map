{"version":3,"file":"AutocompleteTextbox-21d4de0a.js","sources":["../../src/components/inputs/textbox/AutocompleteTextbox.vue"],"sourcesContent":["<template>\n  <div\n    :class=\"[$style.grid, $style[`grid--${labelPosition}`]]\"\n    :id=\"componentId\"\n  >\n    <label\n      :for=\"subId('textbox')\"\n      v-if=\"label && labelPosition !== 'none'\"\n      :class=\"[$style.label, $style[`label--${labelPosition}`]]\"\n    >\n      {{ label }}\n    </label>\n    <div :class=\"$style.wrapper\" ref=\"container\">\n      <input\n        type=\"text\"\n        :placeholder=\"placeholder\"\n        :id=\"subId('textbox')\"\n        :class=\"$style.input\"\n        v-model=\"value\"\n        @focusin=\"focused = true\"\n        ref=\"textbox\"\n      />\n      <div :class=\"$style.options\" v-if=\"focused\" ref=\"dropdown\">\n        <ul v-if=\"dropdownOptions.length > 0\">\n          <li\n            v-for=\"opt in dropdownOptions\"\n            :class=\"$style.option\"\n            @click=\"setOption(opt.value)\"\n            tabindex=\"0\"\n          >\n            <span>{{ opt.label }}</span>\n            <input type=\"hidden\" :value=\"opt.value\" />\n          </li>\n        </ul>\n        <div :class=\"$style.noOptions\" v-else>No options found</div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport { useComponentId } from '../../utils/compid.js';\nimport { useChangeEmits } from '../common.js';\nimport { computed, ref } from 'vue';\nimport {\n  onClickOutside,\n  onKeyStroke,\n  useFocusWithin,\n  useFocus,\n} from '@vueuse/core';\n\nconst props = defineProps({\n  /**\n   * @model\n   */\n  modelValue: {\n    type: String,\n  },\n  /**\n   * Text for the input label.\n   */\n  label: {\n    type: String,\n    default: 'Autocomplete',\n  },\n  /**\n   * Position of the input label (or none).\n   * @values left, right, above, below, none\n   */\n  labelPosition: {\n    type: String,\n    default: 'above',\n  },\n  /**\n   * Debounce delay for the `change` event, in ms.\n   */\n  delay: {\n    type: Number,\n    default: 200,\n  },\n  /**\n   * Text to display in the blank input.\n   */\n  placeholder: {\n    type: [String, undefined],\n    default: null,\n  },\n  /**\n   * The options available to select. Each item can be a string, or an object with `label` and `value` keys.\n   */\n  options: {\n    type: Array,\n  },\n});\n\nconst { componentId, subId } = useComponentId();\n\nconst emit = defineEmits([\n  /**\n   * Emitted when the value changes; debounced if the delay prop is > 0.\n   * @arg {string} newValue the new value\n   */\n  'change',\n  /**\n   * @ignore\n   */\n  'update:modelValue',\n]);\nconst { value } = useChangeEmits(emit, props);\n\nconst dropdownOptions = computed(() => {\n  let outputOptions = [];\n  props.options.forEach((o) => {\n    if (typeof o === 'object') {\n      outputOptions.push({ label: o.label, value: o.value });\n    } else {\n      outputOptions.push({ label: o, value: o });\n    }\n  });\n  return outputOptions;\n});\n\n// elements\nconst container = ref(null);\nconst textbox = ref(null);\nconst dropdown = ref(null);\n\nconst focused = ref(false);\nconst textboxFocus = useFocus(textbox);\nconst dropdownFocus = useFocusWithin(dropdown);\n\nfunction unfocus() {\n  try {\n    container.value.blur();\n    textbox.value.blur();\n    dropdown.value.blur();\n  } catch {\n    // doesn't really matter\n  }\n  focused.value = false;\n}\n\nonClickOutside(container, () => {\n  focused.value = false;\n});\n\nonKeyStroke('ArrowDown', () => {\n  if (dropdownOptions.value.length === 0) {\n    return;\n  }\n  if (textboxFocus.focused.value) {\n    dropdown.value.children[0].children[0].focus();\n  } else if (dropdownFocus.focused.value) {\n    const selectedElement = dropdown.value.querySelector('li:focus');\n    if (!selectedElement || !selectedElement.nextElementSibling) {\n      dropdown.value.children[0].children[0].focus();\n    } else {\n      selectedElement.nextElementSibling.focus();\n    }\n  }\n});\n\nonKeyStroke('ArrowUp', () => {\n  if (dropdownOptions.value.length === 0) {\n    return;\n  }\n  if (dropdownFocus.focused.value) {\n    const selectedElement = dropdown.value.querySelector('li:focus');\n    if (!selectedElement || !selectedElement.previousElementSibling) {\n      textbox.value.focus();\n    } else {\n      selectedElement.previousElementSibling.focus();\n    }\n  }\n});\n\nonKeyStroke('Enter', () => {\n  if (dropdownFocus.focused.value) {\n    const selectedElement = dropdown.value.querySelector('li:focus');\n    if (selectedElement) {\n      setOption(selectedElement.querySelector('input').value);\n    }\n  }\n  unfocus();\n});\n\nfunction setOption(text) {\n  value.value = text;\n  unfocus();\n}\n</script>\n\n<style module lang=\"scss\">\n@import '../inputs';\n\n.wrapper {\n  position: relative;\n}\n\n.options {\n  position: absolute;\n  background: white;\n  border: 1px solid $grey;\n  border-radius: $rounding;\n  width: 100%;\n  margin-top: 2px;\n  font-size: 0.9em;\n\n  & > ul {\n    padding: 0;\n    margin: 0;\n    list-style: none;\n  }\n}\n\n.option {\n  padding: $padding;\n\n  &:hover,\n  &:focus {\n    background: $secondary;\n  }\n\n  &:first-child {\n    border-radius: $rounding $rounding 0 0;\n  }\n\n  &:last-child {\n    border-radius: 0 0 $rounding $rounding;\n  }\n}\n\n.noOptions {\n  font-size: 0.8em;\n  font-style: italic;\n  padding: $padding;\n  opacity: 0.8;\n}\n</style>\n"],"names":["componentId","subId","useComponentId","value","useChangeEmits","emit","props","dropdownOptions","computed","outputOptions","o","container","ref","textbox","dropdown","focused","textboxFocus","useFocus","dropdownFocus","useFocusWithin","unfocus","onClickOutside","onKeyStroke","selectedElement","setOption","text"],"mappings":"qsCA+FM,CAAE,YAAAA,EAAa,MAAAC,GAAUC,IAazB,CAAE,MAAAC,CAAK,EAAKC,EAAeC,EAAMC,CAAK,EAEtCC,EAAkBC,EAAS,IAAM,CACrC,IAAIC,EAAgB,CAAA,EACpB,OAAAH,EAAM,QAAQ,QAASI,GAAM,CACvB,OAAOA,GAAM,SACfD,EAAc,KAAK,CAAE,MAAOC,EAAE,MAAO,MAAOA,EAAE,KAAK,CAAE,EAErDD,EAAc,KAAK,CAAE,MAAOC,EAAG,MAAOA,CAAC,CAAE,CAE/C,CAAG,EACMD,CACT,CAAC,EAGKE,EAAYC,EAAI,IAAI,EACpBC,EAAUD,EAAI,IAAI,EAClBE,EAAWF,EAAI,IAAI,EAEnBG,EAAUH,EAAI,EAAK,EACnBI,EAAeC,EAASJ,CAAO,EAC/BK,EAAgBC,EAAeL,CAAQ,EAE7C,SAASM,GAAU,CACjB,GAAI,CACFT,EAAU,MAAM,OAChBE,EAAQ,MAAM,OACdC,EAAS,MAAM,MACnB,MAAU,CAEP,CACDC,EAAQ,MAAQ,EAClB,CAEAM,EAAeV,EAAW,IAAM,CAC9BI,EAAQ,MAAQ,EAClB,CAAC,EAEDO,EAAY,YAAa,IAAM,CAC7B,GAAIf,EAAgB,MAAM,SAAW,GAGrC,GAAIS,EAAa,QAAQ,MACvBF,EAAS,MAAM,SAAS,CAAC,EAAE,SAAS,CAAC,EAAE,gBAC9BI,EAAc,QAAQ,MAAO,CACtC,MAAMK,EAAkBT,EAAS,MAAM,cAAc,UAAU,EAC3D,CAACS,GAAmB,CAACA,EAAgB,mBACvCT,EAAS,MAAM,SAAS,CAAC,EAAE,SAAS,CAAC,EAAE,QAEvCS,EAAgB,mBAAmB,OAEtC,EACH,CAAC,EAEDD,EAAY,UAAW,IAAM,CAC3B,GAAIf,EAAgB,MAAM,SAAW,GAGjCW,EAAc,QAAQ,MAAO,CAC/B,MAAMK,EAAkBT,EAAS,MAAM,cAAc,UAAU,EAC3D,CAACS,GAAmB,CAACA,EAAgB,uBACvCV,EAAQ,MAAM,QAEdU,EAAgB,uBAAuB,OAE1C,CACH,CAAC,EAEDD,EAAY,QAAS,IAAM,CACzB,GAAIJ,EAAc,QAAQ,MAAO,CAC/B,MAAMK,EAAkBT,EAAS,MAAM,cAAc,UAAU,EAC3DS,GACFC,EAAUD,EAAgB,cAAc,OAAO,EAAE,KAAK,CAEzD,CACDH,GACF,CAAC,EAED,SAASI,EAAUC,EAAM,CACvBtB,EAAM,MAAQsB,EACdL,GACF"}